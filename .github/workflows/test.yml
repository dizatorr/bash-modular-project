name: Test Bash Modular Project

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: üì¶ Checkout –∫–æ–¥–∞
        uses: actions/checkout@v4

      - name: üêß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        run: |
          sudo apt-get update
          sudo apt-get install -y dialog whiptail

      - name: üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
        run: |
          chmod +x start.sh
          chmod +x modules/*.sh

      - name: üß™ –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ (–≤ —Ä–µ–∂–∏–º–µ —Ç–µ—Å—Ç–∞)
        run: |
          # –≠–º—É–ª–∏—Ä—É–µ–º –∑–∞–ø—É—Å–∫: –ø—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ start.sh –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
          bash -n start.sh           # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
          grep -q "main()" start.sh  # –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –µ—Å—Ç—å —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞

          # –ó–∞–ø—É—Å–∫–∞–µ–º –∏ –∂–¥—ë–º –º–µ–Ω—é (–Ω–µ –≤—ã–±–∏—Ä–∞–µ–º –Ω–∏—á–µ–≥–æ)
          timeout 10s ./start.sh || true

      - name: üìÇ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        run: |
          [[ -d "modules" ]] || exit 1
          [[ -d "log" ]] || exit 1
          [[ -f "config/settings.conf" ]] || exit 1
          [[ -x "start.sh" ]] || exit 1

      - name: üìä –û—Ç—á—ë—Ç
        run: echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã!"
